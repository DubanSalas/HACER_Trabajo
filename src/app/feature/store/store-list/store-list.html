<div class="store-container">
  <!-- Header -->
  <div class="page-header">
    <mat-card class="header-card">
      <mat-card-content>
        <div class="header-content">
          <div class="title-section">
            <h1 class="page-title">
              <mat-icon class="title-icon">store</mat-icon>
              Gestión de Almacén
            </h1>
            <p class="page-subtitle">Control de inventario y stock</p>
          </div>
          <div class="header-actions">
            <button 
              mat-raised-button 
              color="primary" 
              class="create-btn"
              (click)="navigateToCreate()">
              <mat-icon>add_box</mat-icon>
              Nuevo Item
            </button>
            <button 
              mat-stroked-button 
              color="accent"
              (click)="generateReport()">
              <mat-icon>description</mat-icon>
              Generar Reporte
            </button>
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- Resumen de almacén -->
  <div class="summary-section" *ngIf="summary">
    <div class="summary-grid">
      <mat-card class="summary-card total-card">
        <mat-card-content>
          <div class="summary-content">
            <div class="summary-icon">
              <mat-icon>inventory_2</mat-icon>
            </div>
            <div class="summary-info">
              <h3>Total Items</h3>
              <div class="summary-value">{{ summary.totalItems }}</div>
            </div>
          </div>
        </mat-card-content>
      </mat-card>

      <mat-card class="summary-card warning-card">
        <mat-card-content>
          <div class="summary-content">
            <div class="summary-icon">
              <mat-icon>warning</mat-icon>
            </div>
            <div class="summary-info">
              <h3>Stock Bajo</h3>
              <div class="summary-value">{{ summary.lowStockItems }}</div>
            </div>
          </div>
        </mat-card-content>
      </mat-card>

      <mat-card class="summary-card danger-card">
        <mat-card-content>
          <div class="summary-content">
            <div class="summary-icon">
              <mat-icon>schedule</mat-icon>
            </div>
            <div class="summary-info">
              <h3>Por Vencer</h3>
              <div class="summary-value">{{ summary.nearExpiryItems }}</div>
            </div>
          </div>
        </mat-card-content>
      </mat-card>

      <mat-card class="summary-card value-card">
        <mat-card-content>
          <div class="summary-content">
            <div class="summary-icon">
              <mat-icon>attach_money</mat-icon>
            </div>
            <div class="summary-info">
              <h3>Valor Total</h3>
              <div class="summary-value">{{ formatPrice(summary.totalInventoryValue) }}</div>
            </div>
          </div>
        </mat-card-content>
      </mat-card>
    </div>
  </div>

  <!-- Filtros Avanzados -->
  <app-advanced-filter 
    [config]="filterConfig"
    searchPlaceholder="Buscar items por producto, código, proveedor, ubicación..."
    [showStatusFilter]="true"
    (filtersChanged)="onFiltersChanged($event)">
  </app-advanced-filter>

  <!-- Lista de items -->
  <mat-card class="store-card">
    <mat-card-header>
      <mat-card-title>
        <mat-icon>list</mat-icon>
        Items de Almacén
      </mat-card-title>
      <mat-card-subtitle>
        Mostrando {{ filteredItems.length }} de {{ storeItems.length }} items
      </mat-card-subtitle>
    </mat-card-header>

    <mat-card-content>
      <!-- Loading -->
      <div *ngIf="loading" class="loading-container">
        <mat-spinner diameter="50"></mat-spinner>
        <p>Cargando inventario...</p>
      </div>

      <!-- Empty state -->
      <div *ngIf="!loading && filteredItems.length === 0" class="empty-state">
        <mat-icon class="empty-icon">store</mat-icon>
        <h3>No se encontraron items</h3>
        <p *ngIf="searchTerm">Intenta ajustar los filtros de búsqueda</p>
        <p *ngIf="!searchTerm">No hay items registrados en el almacén</p>
        <button 
          mat-raised-button 
          color="primary"
          (click)="navigateToCreate()">
          <mat-icon>add_box</mat-icon>
          Registrar Primer Item
        </button>
      </div>

      <!-- Grid de items -->
      <div *ngIf="!loading && filteredItems.length > 0" class="store-grid">
        <mat-card 
          *ngFor="let item of filteredItems; trackBy: trackByItemId" 
          class="store-item-card"
          [class.inactive]="item.status !== 'A'"
          [class.low-stock]="item.lowStock"
          [class.out-of-stock]="item.outOfStock"
          [class.near-expiry]="item.nearExpiry">
          
          <mat-card-header class="item-header">
            <div mat-card-avatar class="item-avatar">
              <mat-icon>{{ item.category === 'Bebidas' ? 'local_drink' : 'inventory_2' }}</mat-icon>
            </div>
            <mat-card-title class="item-name">
              {{ item.productName }}
            </mat-card-title>
            <mat-card-subtitle class="item-code">
              {{ item.itemCode }}
            </mat-card-subtitle>
            <div class="item-status">
              <mat-chip [class]="getStatusClass(item.status)">
                {{ getStatusText(item.status) }}
              </mat-chip>
            </div>
          </mat-card-header>

          <mat-card-content class="item-content">
            <div class="item-info">
              <div class="info-row">
                <mat-icon class="info-icon">category</mat-icon>
                <span class="info-label">Categoría:</span>
                <span class="info-value">{{ item.category }}</span>
              </div>

              <div class="info-row">
                <mat-icon class="info-icon">place</mat-icon>
                <span class="info-label">Ubicación:</span>
                <span class="info-value">{{ item.location }}</span>
              </div>

              <div class="info-row">
                <mat-icon class="info-icon">business</mat-icon>
                <span class="info-label">Proveedor:</span>
                <span class="info-value">{{ item.supplierName || 'Sin proveedor' }}</span>
              </div>

              <div class="info-row stock-row">
                <mat-icon class="info-icon">inventory</mat-icon>
                <span class="info-label">Stock:</span>
                <span class="info-value" [class]="getStockClass(item)">
                  {{ item.currentStock }} / {{ item.minimumStock }}
                </span>
              </div>

              <div class="info-row">
                <mat-icon class="info-icon">schedule</mat-icon>
                <span class="info-label">Vencimiento:</span>
                <span class="info-value" [class]="getExpiryClass(item)">
                  {{ formatDate(item.expiryDate) }}
                </span>
              </div>

              <div class="info-row price-row">
                <mat-icon class="info-icon">attach_money</mat-icon>
                <span class="info-label">Valor Total:</span>
                <span class="info-value price-value">{{ formatPrice(item.totalStockValue) }}</span>
              </div>
            </div>

            <!-- Stock Status Indicator -->
            <div class="stock-indicator" [class]="getStockClass(item)">
              <mat-icon>{{ item.outOfStock ? 'error' : (item.lowStock ? 'warning' : 'check_circle') }}</mat-icon>
              <span>{{ getStockLabel(item) }}</span>
            </div>

            <!-- Expiry Warning -->
            <div *ngIf="item.nearExpiry" class="expiry-warning">
              <mat-icon>schedule</mat-icon>
              <span>Próximo a vencer</span>
            </div>
          </mat-card-content>

          <mat-card-actions class="item-actions">
            <button 
              mat-button 
              color="primary"
              (click)="viewItem(item)"
              matTooltip="Ver detalles">
              <mat-icon>visibility</mat-icon>
              Ver
            </button>

            <button 
              mat-button 
              color="accent"
              (click)="updateStock(item)"
              matTooltip="Actualizar stock">
              <mat-icon>edit</mat-icon>
              Stock
            </button>

            <button 
              mat-button 
              color="accent"
              (click)="editItem(item)"
              matTooltip="Editar item">
              <mat-icon>edit</mat-icon>
              Editar
            </button>

            <button 
              *ngIf="item.status === 'A'"
              mat-button 
              color="warn"
              (click)="deleteItem(item)"
              matTooltip="Desactivar item">
              <mat-icon>remove_circle</mat-icon>
              Desactivar
            </button>

            <button 
              *ngIf="item.status !== 'A'"
              mat-button 
              color="primary"
              (click)="restoreItem(item)"
              matTooltip="Reactivar item">
              <mat-icon>add_circle</mat-icon>
              Reactivar
            </button>

            <button 
              mat-icon-button
              [matMenuTriggerFor]="itemMenu"
              matTooltip="Más opciones">
              <mat-icon>more_vert</mat-icon>
            </button>

            <mat-menu #itemMenu="matMenu">
              <button mat-menu-item>
                <mat-icon>history</mat-icon>
                Ver Historial
              </button>
              <button mat-menu-item>
                <mat-icon>local_shipping</mat-icon>
                Solicitar Reposición
              </button>
              <button mat-menu-item>
                <mat-icon>qr_code</mat-icon>
                Generar Etiqueta
              </button>
            </mat-menu>
          </mat-card-actions>
        </mat-card>
      </div>
    </mat-card-content>
  </mat-card>
</div>