<div class="store-container">
  <!-- Header -->
  <div class="header">
    <div class="header-content">
      <h1>Gestión de Almacén</h1>
      <p class="subtitle">Control completo de inventario y stock</p>
    </div>
    <div class="header-actions">
      <button mat-raised-button class="report-btn">
        <mat-icon>description</mat-icon>
        Reporte
      </button>
    </div>
  </div>

  <!-- Stats Cards -->
  <div class="stats-grid">
    <div class="stat-card total">
      <div class="stat-content">
        <div class="stat-info">
          <h3>Total Productos</h3>
          <p class="stat-value">{{ stats.total_products }}</p>
          <p class="stat-subtitle">En inventario</p>
        </div>
        <div class="stat-icon">
          <mat-icon>inventory</mat-icon>
        </div>
      </div>
    </div>

    <div class="stat-card low-stock">
      <div class="stat-content">
        <div class="stat-info">
          <h3>Stock Bajo</h3>
          <p class="stat-value">{{ stats.low_stock }}</p>
          <p class="stat-subtitle">Requieren atención</p>
        </div>
        <div class="stat-icon">
          <mat-icon>warning</mat-icon>
        </div>
      </div>
    </div>

    <div class="stat-card out-of-stock">
      <div class="stat-content">
        <div class="stat-info">
          <h3>Agotados</h3>
          <p class="stat-value">{{ stats.out_of_stock }}</p>
          <p class="stat-subtitle">Sin stock</p>
        </div>
        <div class="stat-icon">
          <mat-icon>remove_shopping_cart</mat-icon>
        </div>
      </div>
    </div>

    <div class="stat-card expiring">
      <div class="stat-content">
        <div class="stat-info">
          <h3>Próximos a Vencer</h3>
          <p class="stat-value">{{ stats.expiring_soon }}</p>
          <p class="stat-subtitle">En 7 días</p>
        </div>
        <div class="stat-icon">
          <mat-icon>schedule</mat-icon>
        </div>
      </div>
    </div>
  </div>

  <!-- Filters and Actions -->
  <div class="filters-section">
    <div class="search-container">
      <mat-icon class="search-icon">search</mat-icon>
      <input 
        type="text" 
        placeholder="Buscar por nombre o proveedor..." 
        [(ngModel)]="searchTerm"
        (input)="onSearch()"
        class="search-input">
    </div>

    <div class="filters-container">
      <mat-form-field appearance="outline" class="filter-field">
        <mat-label>Todas las Categorías</mat-label>
        <mat-select [(value)]="filters.category" (selectionChange)="onFilterChange()">
          <mat-option value="">Todas las Categorías</mat-option>
          <mat-option *ngFor="let category of categories" [value]="category">
            {{ category }}
          </mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="outline" class="filter-field">
        <mat-label>Todos los Activos</mat-label>
        <mat-select [(value)]="filters.status" (selectionChange)="onFilterChange()">
          <mat-option value="">Todos los Activos</mat-option>
          <mat-option *ngFor="let status of statuses" [value]="status">
            {{ status }}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div>

    <div class="action-buttons">
      <button mat-icon-button (click)="toggleViewMode()" class="view-toggle">
        <mat-icon>{{ viewMode === 'list' ? 'view_module' : 'view_list' }}</mat-icon>
      </button>
      <span class="view-label">Vista:</span>
      <button mat-raised-button color="primary" (click)="openCreateForm()" class="new-item-btn">
        <mat-icon>add_circle</mat-icon>
        Agregar Producto
      </button>
    </div>
  </div>

  <!-- Loading Spinner -->
  <div *ngIf="loading" class="loading-container">
    <mat-spinner diameter="50"></mat-spinner>
    <p>Cargando inventario...</p>
  </div>

  <!-- Store Items Table -->
  <div *ngIf="!loading" class="table-container">
    <table class="store-table">
      <thead>
        <tr>
          <th>PRODUCTO</th>
          <th>CATEGORÍA</th>
          <th>STOCK</th>
          <th>PRECIO UNIT</th>
          <th>PROVEEDOR</th>
          <th>VENCIMIENTO</th>
          <th>ESTADO</th>
          <th>ACCIONES</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let item of filteredItems" class="store-row">
          <td>
            <div class="product-info">
              <div class="product-image">
                <mat-icon>inventory_2</mat-icon>
              </div>
              <div class="product-details">
                <span class="product-name">{{ item.product_name }}</span>
                <span class="product-id">ID: {{ item.id_Product }}</span>
              </div>
            </div>
          </td>
          <td>{{ item.category }}</td>
          <td>
            <div class="stock-info" [ngClass]="getStockClass(item)">
              <span class="stock-amount">{{ formatStock(item.current_stock, item.unit) }}</span>
              <span class="stock-min">Mín: {{ item.min_stock }}</span>
            </div>
          </td>
          <td class="price-cell">{{ formatCurrency(item.unit_price) }}</td>
          <td>{{ item.supplier_name || 'N/A' }}</td>
          <td>
            <div class="expiry-info">
              <span class="expiry-date">{{ formatDate(item.expiry_date) }}</span>
              <span *ngIf="isExpired(item.expiry_date)" class="expiry-warning expired">Vencido</span>
              <span *ngIf="isExpiringSoon(item.expiry_date) && !isExpired(item.expiry_date)" class="expiry-warning expiring">Próximo</span>
            </div>
          </td>
          <td>
            <span class="status-badge" [ngClass]="getStatusClass(item.status)">
              {{ item.status }}
            </span>
          </td>
          <td>
            <div class="action-buttons">
              <button mat-icon-button (click)="openEditForm(item)" class="edit-btn" title="Editar">
                <mat-icon>edit</mat-icon>
              </button>
              <button mat-icon-button (click)="viewItem(item)" class="view-btn" title="Ver">
                <mat-icon>visibility</mat-icon>
              </button>
              <button mat-icon-button (click)="deleteItem(item)" class="delete-btn" title="Eliminar">
                <mat-icon>delete</mat-icon>
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>

    <!-- Empty State -->
    <div *ngIf="filteredItems.length === 0" class="empty-state">
      <mat-icon>inventory</mat-icon>
      <h3>No se encontraron productos</h3>
      <p>No hay productos en el almacén que coincidan con los filtros aplicados</p>
      <button mat-raised-button color="primary" (click)="clearFilters()">
        Limpiar Filtros
      </button>
    </div>
  </div>

  <!-- Store Form Modal -->
  <app-store-form
    *ngIf="showForm"
    [storeItem]="selectedItem"
    (close)="onFormClose()"
    (success)="onFormSuccess()">
  </app-store-form>
</div>