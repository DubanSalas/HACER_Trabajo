<div class="sales-container">
  <!-- Header -->
  <div class="header">
    <div class="header-content">
      <h1>Gestión de Ventas</h1>
      <p class="subtitle">Registro completo de transacciones y ventas</p>
    </div>
    <div class="header-actions">
      <button mat-raised-button class="report-btn">
        <mat-icon>description</mat-icon>
        Reporte
      </button>
    </div>
  </div>

  <!-- Stats Cards -->
  <div class="stats-grid">
    <div class="stat-card total">
      <div class="stat-content">
        <div class="stat-info">
          <h3>Ventas Totales</h3>
          <p class="stat-value">{{ formatCurrency(stats.total_ventas) }}</p>
          <p class="stat-subtitle">{{ stats.ventas_totales }} transacciones</p>
        </div>
        <div class="stat-icon">
          <mat-icon>attach_money</mat-icon>
        </div>
      </div>
    </div>

    <div class="stat-card today">
      <div class="stat-content">
        <div class="stat-info">
          <h3>Ventas Hoy</h3>
          <p class="stat-value">{{ formatCurrency(stats.total_hoy) }}</p>
          <p class="stat-subtitle">{{ stats.ventas_hoy }} ventas</p>
        </div>
        <div class="stat-icon">
          <mat-icon>today</mat-icon>
        </div>
      </div>
    </div>

    <div class="stat-card completed">
      <div class="stat-content">
        <div class="stat-info">
          <h3>Completadas</h3>
          <p class="stat-value">{{ stats.completadas }}</p>
          <p class="stat-subtitle">Ventas exitosas</p>
        </div>
        <div class="stat-icon">
          <mat-icon>check_circle</mat-icon>
        </div>
      </div>
    </div>

    <div class="stat-card pending">
      <div class="stat-content">
        <div class="stat-info">
          <h3>Pendientes</h3>
          <p class="stat-value">{{ stats.pendientes }}</p>
          <p class="stat-subtitle">Por procesar</p>
        </div>
        <div class="stat-icon">
          <mat-icon>schedule</mat-icon>
        </div>
      </div>
    </div>
  </div>

  <!-- Filters and Actions -->
  <div class="filters-section">
    <div class="search-container">
      <mat-icon class="search-icon">search</mat-icon>
      <input 
        type="text" 
        placeholder="Buscar por nombre..." 
        [(ngModel)]="searchTerm"
        (input)="onSearch()"
        class="search-input">
    </div>

    <div class="filters-container">
      <mat-form-field appearance="outline" class="filter-field">
        <mat-label>Todos los Estados</mat-label>
        <mat-select [(value)]="filters.estado" (selectionChange)="onFilterChange()">
          <mat-option value="">Todos los Estados</mat-option>
          <mat-option *ngFor="let estado of estados" [value]="estado">
            {{ estado }}
          </mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="outline" class="filter-field">
        <mat-label>Método de Pago</mat-label>
        <mat-select [(value)]="filters.metodo_pago" (selectionChange)="onFilterChange()">
          <mat-option value="">Todos</mat-option>
          <mat-option *ngFor="let metodo of metodosPago" [value]="metodo">
            {{ metodo }}
          </mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="outline" class="filter-field">
        <mat-label>Fecha Inicio</mat-label>
        <input matInput type="date" [(ngModel)]="filters.fecha_inicio" (change)="onFilterChange()">
      </mat-form-field>

      <mat-form-field appearance="outline" class="filter-field">
        <mat-label>Fecha Fin</mat-label>
        <input matInput type="date" [(ngModel)]="filters.fecha_fin" (change)="onFilterChange()">
      </mat-form-field>
    </div>

    <div class="action-buttons">
      <button mat-icon-button (click)="toggleViewMode()" class="view-toggle">
        <mat-icon>{{ viewMode === 'list' ? 'view_module' : 'view_list' }}</mat-icon>
      </button>
      <span class="view-label">Vista:</span>
      <button mat-raised-button color="primary" (click)="openCreateForm()" class="new-sale-btn">
        <mat-icon>add_circle</mat-icon>
        Nueva Venta
      </button>
    </div>
  </div>

  <!-- Loading Spinner -->
  <div *ngIf="loading" class="loading-container">
    <mat-spinner diameter="50"></mat-spinner>
    <p>Cargando ventas...</p>
  </div>

  <!-- Sales Table -->
  <div *ngIf="!loading" class="table-container">
    <table class="sales-table">
      <thead>
        <tr>
          <th>ID VENTAS</th>
          <th>CLIENTE</th>
          <th>EMPLEADO</th>
          <th>FECHA</th>
          <th>MÉTODO DE PAGO</th>
          <th>TOTAL</th>
          <th>ESTADO</th>
          <th>ACCIONES</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let sale of filteredSales" class="sale-row">
          <td>
            <div class="sale-id">
              <mat-icon class="sale-icon">shopping_cart</mat-icon>
              {{ sale.id_venta }}
            </div>
          </td>
          <td>{{ getCustomerName(sale.idCustomer) }}</td>
          <td>{{ getEmployeeName(sale.id_Employee) }}</td>
          <td>{{ formatDate(sale.fecha_venta) }}</td>
          <td>{{ sale.metodo_pago }}</td>
          <td class="total-cell">{{ formatCurrency(sale.total) }}</td>
          <td>
            <span class="status-badge" [ngClass]="getStatusClass(sale.estado)">
              {{ sale.estado }}
            </span>
          </td>
          <td>
            <div class="action-buttons">
              <button mat-icon-button (click)="openEditForm(sale)" class="edit-btn" title="Editar">
                <mat-icon>edit</mat-icon>
              </button>
              <button mat-icon-button (click)="viewSale(sale)" class="view-btn" title="Ver">
                <mat-icon>visibility</mat-icon>
              </button>
              <button mat-icon-button (click)="deleteSale(sale)" class="delete-btn" title="Eliminar">
                <mat-icon>delete</mat-icon>
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>

    <!-- Empty State -->
    <div *ngIf="filteredSales.length === 0" class="empty-state">
      <mat-icon>shopping_cart</mat-icon>
      <h3>No se encontraron ventas</h3>
      <p>No hay ventas que coincidan con los filtros aplicados</p>
      <button mat-raised-button color="primary" (click)="clearFilters()">
        Limpiar Filtros
      </button>
    </div>
  </div>

  <!-- Sales Form Modal -->
  <app-sales-form
    *ngIf="showForm"
    [sale]="selectedSale"
    (close)="onFormClose()"
    (success)="onFormSuccess()">
  </app-sales-form>
</div>